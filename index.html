<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura de Lectura para Cuarto B√°sico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuente Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .text-content p {
            margin-bottom: 1rem; /* Espacio entre p√°rrafos */
        }
        .text-content ul, .text-content ol {
            margin-left: 1.5rem;
            list-style-type: disc;
            margin-bottom: 1rem;
        }
        .text-content ol {
            list-style-type: decimal;
        }
        .text-content h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-teal-50 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl w-full border-4 border-green-300">
        <h1 class="text-4xl md:text-5xl font-extrabold text-green-700 mb-6 text-center leading-tight">
            ¬°Aventura de Lectura para Cuarto B√°sico! üß†
        </h1>
        <p class="text-lg text-gray-700 mb-8 text-center">
            Explora diferentes tipos de textos, pon a prueba tu comprensi√≥n y avanza en tu camino lector. ¬°Adelante!
        </p>

        <div class="bg-teal-100 p-4 rounded-lg shadow-md mb-8 border-2 border-teal-300">
            <h2 class="text-2xl font-bold text-teal-800 mb-4 text-center">Selecciona tu Desaf√≠o:</h2>
            <div id="text-selector-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                </div>
        </div>

        <div id="lesson-content" class="hidden">
            <div class="bg-green-100 p-6 rounded-lg shadow-md mb-8 border-2 border-green-300">
                <h2 id="story-title" class="text-3xl font-bold text-green-800 mb-4 text-center"></h2>
                <div id="story-text" class="text-content text-lg leading-relaxed text-gray-800"></div>
            </div>

            <div class="bg-yellow-100 p-6 rounded-lg shadow-md mb-8 border-2 border-yellow-300">
                <h2 class="text-3xl font-bold text-yellow-800 mb-4 text-center">Preguntas de Comprensi√≥n</h2>
                <div id="questions-container" class="space-y-6">
                    </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                <button id="check-answers-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out text-xl">
                    Verificar Respuestas
                </button>
                <button id="reset-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out text-xl">
                    Reiniciar
                </button>
                <button id="next-text-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out text-xl hidden">
                    Siguiente Desaf√≠o ‚ñ∂Ô∏è
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATOS DE LOS TEXTOS Y PREGUNTAS ---
        const readingContent = [
            {
                id: 'roble-sabio',
                order: 1,
                type: 'Cuento',
                title: 'El Secreto del Viejo Roble',
                text: `
                    <p>En el coraz√≥n del Bosque Susurrante, viv√≠a un roble centenario cuyas ramas se extend√≠an como brazos gigantes hacia el cielo. Los animales del bosque lo llamaban "El Sabio", pues se dec√≠a que guardaba un secreto ancestral. Un d√≠a, una peque√±a ardilla, de nombre Nuez, se atrevi√≥ a preguntarle: "¬øQu√© secreto guardas, viejo roble?"</p>
                    <p>El roble, con voz grave y hojas que cruj√≠an suavemente, respondi√≥: "Mi secreto no es algo que se pueda ver, Nuez. Es la paciencia. He visto pasar inviernos y veranos, sequ√≠as y lluvias. He visto crecer y caer a muchas generaciones. Aprend√≠ que la prisa es enemiga de la sabidur√≠a. Solo con tiempo y observaci√≥n se revelan los misterios m√°s grandes."</p>
                    <p>Nuez, aunque peque√±a, comprendi√≥ la profundidad de las palabras del roble. Desde ese d√≠a, la ardilla no solo recolectaba nueces, sino que tambi√©n se sentaba a observar el bosque con calma, aprendiendo de cada peque√±o detalle, tal como le hab√≠a ense√±ado el sabio roble.</p>
                `,
                // imageUrl: 'https://placehold.co/600x300/A0E0FF/000000?text=Roble+Sabio', // Imagen eliminada
                questions: [
                    { id: 'q1_1', question: '1. ¬øCu√°l es la principal cualidad que el viejo roble le ense√±a a la ardilla Nuez?', options: ['a) La fuerza.', 'b) La velocidad.', 'c) La paciencia.', 'd) La astucia.'], answer: 'c) La paciencia.' },
                    { id: 'q1_2', question: '2. ¬øQu√© significa la expresi√≥n "la prisa es enemiga de la sabidur√≠a" en el contexto del texto?', options: ['a) Que hay que correr para ser inteligente.', 'b) Que la sabidur√≠a se consigue r√°pido.', 'c) Que para aprender bien, no hay que apurarse.', 'd) Que los sabios son lentos.'], answer: 'c) Que para aprender bien, no hay que apurarse.' },
                    { id: 'q1_3', question: '3. ¬øC√≥mo cambi√≥ la actitud de Nuez despu√©s de hablar con el roble?', options: ['a) Dej√≥ de recolectar nueces.', 'b) Se volvi√≥ m√°s impaciente.', 'c) Empez√≥ a observar el bosque con calma.', 'd) Se fue a otro bosque.'], answer: 'c) Empez√≥ a observar el bosque con calma.' },
                    { id: 'q1_4', question: '4. ¬øQu√© tipo de texto es "El Secreto del Viejo Roble"?', options: ['a) Una f√°bula.', 'b) Un poema.', 'c) Un cuento.', 'd) Una receta.'], answer: 'c) Un cuento.' },
                ]
            },
            {
                id: 'leyenda-copihue',
                order: 2,
                type: 'Leyenda',
                title: 'La Leyenda del Copihue',
                text: `
                    <p>En los bosques del sur de Chile, donde los araucanos viv√≠an en armon√≠a con la naturaleza, naci√≥ una hermosa flor roja: el copihue. La leyenda cuenta que hace mucho tiempo, dos tribus, la de los Pehuenches y la de los Lafkenches, estaban en guerra. El amor prohibido floreci√≥ entre Hueso, un joven Pehuenche, y Maqui, una doncella Lafkenche. Se encontraban en secreto junto a un lago.</p>
                    <p>Un d√≠a, sus padres los descubrieron. Furiosos por la traici√≥n, los guerreros de ambas tribus los atacaron con flechas. Los j√≥venes cayeron abrazados al agua del lago. La tristeza invadi√≥ el bosque y la naturaleza llor√≥ su amor. Al amanecer, en el lugar donde cayeron, brotaron dos plantas que se entrelazaron. De ellas nacieron flores rojas como la sangre de los j√≥venes y blancas como la pureza de su amor.</p>
                    <p>As√≠ naci√≥ el copihue, la flor nacional de Chile, que nos recuerda el amor y la paz que deben reinar entre los pueblos, y la belleza que puede surgir incluso de la tristeza m√°s profunda.</p>
                `,
                // imageUrl: 'https://placehold.co/600x300/C1DDC1/000000?text=Leyenda+Copihue', // Imagen eliminada
                questions: [
                    { id: 'q2_1', question: '1. ¬øCu√°l es el origen del copihue, seg√∫n esta leyenda?', options: ['a) Fue plantado por los dioses.', 'b) Naci√≥ del amor prohibido de dos j√≥venes.', 'c) Creci√≥ de la tierra m√°gica.', 'd) Fue tra√≠do por los colonizadores.'], answer: 'b) Naci√≥ del amor prohibido de dos j√≥venes.' },
                    { id: 'q2_2', question: '2. ¬øQu√© simbolizan los colores rojo y blanco del copihue en la leyenda?', options: ['a) El sol y la luna.', 'b) La sangre de los j√≥venes y la pureza de su amor.', 'c) El d√≠a y la noche.', 'd) La guerra y la paz.'], answer: 'b) La sangre de los j√≥venes y la pureza de su amor.' },
                    { id: 'q2_3', question: '3. ¬øQu√© mensaje principal nos deja la leyenda del copihue?', options: ['a) La importancia de la guerra entre tribus.', 'b) La belleza de los bosques chilenos.', 'c) El valor del amor y la paz entre los pueblos.', 'd) C√≥mo se cultivan las flores.'], answer: 'c) El valor del amor y la paz entre los pueblos.' },
                    { id: 'q2_4', question: '4. ¬øQu√© tipo de texto es "La Leyenda del Copihue"?', options: ['a) Un texto instructivo.', 'b) Una noticia.', 'c) Una leyenda.', 'd) Una biograf√≠a.'], answer: 'c) Una leyenda.' },
                ]
            },
            {
                id: 'ciclo-agua',
                order: 3,
                type: 'Art√≠culo Informativo',
                title: 'El Ciclo del Agua',
                text: `
                    <p>El agua de nuestro planeta est√° siempre en movimiento, cambiando de estado y viajando por la Tierra. Este proceso se llama el ciclo del agua y es fundamental para la vida.</p>
                    <h3>Evaporaci√≥n:</h3>
                    <p>El calor del sol calienta el agua de los oc√©anos, r√≠os y lagos, convirti√©ndola en vapor. Este vapor sube a la atm√≥sfera.</p>
                    <h3>Condensaci√≥n:</h3>
                    <p>En la atm√≥sfera, el vapor de agua se enfr√≠a y se transforma en peque√±as gotas, formando las nubes.</p>
                    <h3>Precipitaci√≥n:</h3>
                    <p>Cuando las nubes se llenan de estas gotas, el agua cae a la Tierra en forma de lluvia, nieve o granizo.</p>
                    <h3>Recolecci√≥n:</h3>
                    <p>El agua que cae se acumula en oc√©anos, r√≠os, lagos y tambi√©n se filtra en la tierra, formando aguas subterr√°neas. Luego, el ciclo vuelve a empezar.</p>
                `,
                // imageUrl: 'https://placehold.co/600x300/DDC1FF/000000?text=Ciclo+Agua', // Imagen eliminada
                questions: [
                    { id: 'q3_1', question: '1. ¬øCu√°l es la fuerza principal que inicia el proceso de evaporaci√≥n del agua?', options: ['a) El viento.', 'b) El fr√≠o.', 'c) El calor del sol.', 'd) La gravedad.'], answer: 'c) El calor del sol.' },
                    { id: 'q3_2', question: '2. ¬øQu√© etapa del ciclo del agua es responsable de la formaci√≥n de las nubes?', options: ['a) Evaporaci√≥n.', 'b) Precipitaci√≥n.', 'c) Recolecci√≥n.', 'd) Condensaci√≥n.'], answer: 'd) Condensaci√≥n.' },
                    { id: 'q3_3', question: '3. ¬øEn qu√© formas puede caer el agua a la Tierra durante la precipitaci√≥n?', options: ['a) Solo lluvia.', 'b) Lluvia, nieve o granizo.', 'c) Vapor y nubes.', 'd) Solo granizo.'], answer: 'b) Lluvia, nieve o granizo.' },
                    { id: 'q3_4', question: '4. ¬øCu√°l es el prop√≥sito principal de un texto como "El Ciclo del Agua"?', options: ['a) Contar una historia divertida.', 'b) Dar una opini√≥n sobre el agua.', 'c) Explicar un proceso natural.', 'd) Convencer de algo.'], answer: 'c) Explicar un proceso natural.' },
                ]
            },
            {
                id: 'mi-gato-saltador',
                order: 4,
                type: 'Poema',
                title: 'Mi Gato Saltador',
                text: `
                    <p>Mi gato es un acr√≥bata,</p>
                    <p>salta y salta sin parar.</p>
                    <p>Desde el sill√≥n a la ventana,</p>
                    <p>parece que va a volar.</p>
                    <br>
                    <p>Sus ojos verdes, brillantes,</p>
                    <p>miran todo con atenci√≥n.</p>
                    <p>Es un cazador elegante,</p>
                    <p>lleno de gracia y emoci√≥n.</p>
                    <br>
                    <p>Con su cola larga y suave,</p>
                    <p>equilibrio sabe guardar.</p>
                    <p>Mi gato es una nave,</p>
                    <p>que no para de jugar.</p>
                `,
                // imageUrl: 'https://placehold.co/600x300/D1D1FF/000000?text=Gato+Saltador', // Imagen eliminada
                questions: [
                    { id: 'q4_1', question: '1. ¬øQu√© caracter√≠stica principal del gato se destaca en el poema?', options: ['a) Su color.', 'b) Su habilidad para saltar.', 'c) Su voz.', 'd) Su tama√±o.'], answer: 'b) Su habilidad para saltar.' },
                    { id: 'q4_2', question: '2. ¬øCon qu√© compara el autor los ojos del gato?', options: ['a) Con estrellas.', 'b) Con esmeraldas.', 'c) Con canicas.', 'd) Con botones.'], answer: 'b) Con esmeraldas.' },
                    { id: 'q4_3', question: '3. ¬øQu√© parte del cuerpo del gato le ayuda a mantener el equilibrio?', options: ['a) Sus patas.', 'b) Sus orejas.', 'c) Su cola.', 'd) Sus bigotes.'], answer: 'c) Su cola.' },
                    { id: 'q4_4', question: '4. ¬øQu√© sentimiento principal transmite el poema hacia el gato?', options: ['a) Miedo.', 'b) Aburrimiento.', 'c) Admiraci√≥n y cari√±o.', 'd) Sorpresa.'], answer: 'c) Admiraci√≥n y cari√±o.' },
                ]
            },
            {
                id: 'noticia-mariposa',
                order: 5,
                type: 'Noticia',
                title: 'Descubren Nueva Especie de Mariposa en el Bosque Nuboso',
                text: `
                    <p><strong>CIUDAD VERDE, 20 de mayo de 2025 ‚Äì</strong> Un equipo de cient√≠ficos de la Universidad Nacional ha anunciado hoy el descubrimiento de una nueva especie de mariposa en el remoto Bosque Nuboso de la Cordillera del Arco√≠ris. La mariposa, bautizada como "Alas de Cristal" por la transparencia de sus alas, fue encontrada durante una expedici√≥n de investigaci√≥n de tres meses.</p>
                    <p>La Dra. Elena R√≠os, l√≠der del equipo, explic√≥ que esta mariposa se alimenta de un tipo espec√≠fico de orqu√≠dea que solo crece en esa regi√≥n. "Este hallazgo es crucial para entender la biodiversidad de nuestro planeta y la importancia de proteger estos ecosistemas √∫nicos," afirm√≥ la Dra. R√≠os en una conferencia de prensa. Se espera que el descubrimiento impulse nuevas iniciativas de conservaci√≥n en la zona.</p>
                `,
                // imageUrl: 'https://placehold.co/600x300/B0E0B0/000000?text=Mariposa+Nueva', // Imagen eliminada
                questions: [
                    { id: 'q5_1', question: '1. ¬øQui√©nes descubrieron la nueva especie de mariposa?', options: ['a) Un grupo de turistas.', 'b) Estudiantes de primaria.', 'c) Un equipo de cient√≠ficos.', 'd) Unos exploradores de la selva.'], answer: 'c) Un equipo de cient√≠ficos.' },
                    { id: 'q5_2', question: '2. ¬øD√≥nde fue encontrada la mariposa "Alas de Cristal"?', options: ['a) En un jard√≠n bot√°nico.', 'b) En el Bosque Nuboso de la Cordillera del Arco√≠ris.', 'c) En un zool√≥gico.', 'd) En la ciudad.'], answer: 'b) En el Bosque Nuboso de la Cordillera del Arco√≠ris.' },
                    { id: 'q5_3', question: '3. ¬øPor qu√© el hallazgo de esta mariposa es importante, seg√∫n la Dra. Elena R√≠os?', options: ['a) Para venderla en el mercado.', 'b) Para entender la biodiversidad y proteger los ecosistemas.', 'c) Para decorar museos.', 'd) Para estudiar su vuelo.'], answer: 'b) Para entender la biodiversidad y proteger los ecosistemas.' },
                    { id: 'q5_4', question: '4. ¬øCu√°l es el prop√≥sito principal de una noticia como esta?', options: ['a) Contar una historia de fantas√≠a.', 'b) Dar una opini√≥n personal.', 'c) Informar sobre un evento o descubrimiento reciente.', 'd) Ense√±ar a hacer algo.'], answer: 'c) Informar sobre un evento o descubrimiento reciente.' },
                ]
            },
            {
                id: 'instrucciones-juego',
                order: 6,
                type: 'Instrucciones de Juego',
                title: 'Instrucciones: El Tesoro Escondido',
                text: `
                    <p><strong>Jugadores:</strong> 2 a 4</p>
                    <p><strong>Materiales:</strong> Tablero de juego, 4 fichas de colores, 1 dado, 20 cartas de "Pista", 10 cartas de "Trampa".</p>
                    <h3>Objetivo del Juego:</h3>
                    <p>Ser el primer jugador en encontrar el Tesoro Escondido en el centro del tablero.</p>
                    <h3>C√≥mo Jugar:</h3>
                    <ol>
                        <li>Cada jugador elige una ficha y la coloca en la casilla de "Inicio".</li>
                        <li>El jugador m√°s joven comienza. El turno pasa hacia la derecha.</li>
                        <li>En tu turno, lanza el dado y avanza tu ficha el n√∫mero de casillas indicado.</li>
                        <li>Si caes en una casilla con una "Pista", toma una carta de "Pista" y sigue la instrucci√≥n.</li>
                        <li>Si caes en una casilla con una "Trampa", toma una carta de "Trampa" y sigue la instrucci√≥n (¬°cuidado, pueden hacerte retroceder!).</li>
                        <li>El juego termina cuando un jugador llega exactamente a la casilla central del Tesoro.</li>
                    </ol>
                `,
                // imageUrl: 'https://placehold.co/600x300/FFDDC1/000000?text=Juego+Mesa', // Imagen eliminada
                questions: [
                    { id: 'q6_1', question: '1. ¬øCu√°ntos jugadores pueden participar como m√°ximo en este juego?', options: ['a) 2.', 'b) 3.', 'c) 4.', 'd) 5.'], answer: 'c) 4.' },
                    { id: 'q6_2', question: '2. ¬øQu√© debe hacer un jugador si cae en una casilla con una "Trampa"?', options: ['a) Avanzar dos casillas.', 'b) Robar una ficha a otro jugador.', 'c) Tomar una carta de "Trampa" y seguir su instrucci√≥n.', 'd) Perder el turno.'], answer: 'c) Tomar una carta de "Trampa" y seguir su instrucci√≥n.' },
                    { id: 'q6_3', question: '3. ¬øCu√°l es el objetivo final de los jugadores en "El Tesoro Escondido"?', options: ['a) Recolectar todas las cartas.', 'b) Ser el primer jugador en llegar al Tesoro.', 'c) Eliminar a los otros jugadores.', 'd) Dar la vuelta completa al tablero.'], answer: 'b) Ser el primer jugador en llegar al Tesoro.' },
                    { id: 'q6_4', question: '4. ¬øQu√© tipo de texto es este, seg√∫n su funci√≥n?', options: ['a) Un poema.', 'b) Una carta.', 'c) Un texto instructivo.', 'd) Una f√°bula.'], answer: 'c) Un texto instructivo.' },
                ]
            }
        ];

        // --- VARIABLES GLOBALES Y ELEMENTOS DEL DOM ---
        let currentTextIndex = 0;
        let userProgress = loadProgress(); // Carga el progreso guardado

        const correctSound = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3'); // Sonido de √©xito
        const incorrectSound = new Audio('https://www.soundjay.com/buttons/sounds/button-9.mp3'); // Sonido de error

        const textSelectorContainer = document.getElementById('text-selector-container');
        const lessonContentDiv = document.getElementById('lesson-content');
        const storyTitleElem = document.getElementById('story-title');
        // const storyImageElem = document.getElementById('story-image'); // Elemento de imagen eliminado
        const storyTextElem = document.getElementById('story-text');
        const questionsContainer = document.getElementById('questions-container');
        const checkBtn = document.getElementById('check-answers-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextTextBtn = document.getElementById('next-text-btn');

        // --- FUNCIONES DE PROGRESO (localStorage) ---
        function loadProgress() {
            try {
                const progress = localStorage.getItem('readingComprehensionProgress4thGrade'); // ID √∫nico para 4to grado
                return progress ? JSON.parse(progress) : {};
            } catch (e) {
                console.error("Error al cargar el progreso de localStorage:", e);
                return {};
            }
        }

        function saveProgress() {
            try {
                localStorage.setItem('readingComprehensionProgress4thGrade', JSON.stringify(userProgress)); // ID √∫nico
            } catch (e) {
                console.error("Error al guardar el progreso en localStorage:", e);
            }
        }

        function markTextAsCompleted(textId) {
            userProgress[textId] = true;
            saveProgress();
            renderTextSelector(); // Actualiza la visualizaci√≥n de los botones
        }

        function isTextCompleted(textId) {
            return userProgress[textId] === true;
        }

        function isTextUnlocked(textOrder) {
            if (textOrder === 1) {
                return true; // El primer texto siempre est√° desbloqueado
            }
            const previousText = readingContent.find(t => t.order === textOrder - 1);
            return previousText && isTextCompleted(previousText.id);
        }

        // --- FUNCIONES DE RENDERIZADO ---
        function renderTextSelector() {
            textSelectorContainer.innerHTML = ''; // Limpiar selectores anteriores
            readingContent.sort((a, b) => a.order - b.order).forEach((textData, index) => {
                const unlocked = isTextUnlocked(textData.order);
                const completed = isTextCompleted(textData.id);
                const button = document.createElement('button');
                button.className = `
                    py-3 px-4 rounded-lg shadow-md transform hover:scale-105 transition duration-300 ease-in-out text-base font-semibold flex items-center justify-center text-center
                    ${unlocked ? (completed ? 'bg-green-300 hover:bg-green-400 text-green-900' : 'bg-teal-400 hover:bg-teal-500 text-white') : 'bg-gray-300 text-gray-600 cursor-not-allowed opacity-70'}
                `;
                button.disabled = !unlocked;
                button.dataset.index = index;
                button.innerHTML = `
                    <span class="text-2xl mr-2">${unlocked ? (completed ? '‚úÖ' : 'üìñ') : 'üîí'}</span>
                    <div>
                        ${textData.title}
                        <span class="block text-sm font-normal">${textData.type}</span>
                        <span class="block text-xs font-normal mt-0.5">${unlocked ? (completed ? '(Completado)' : '(Bloqueado)') : '(Bloqueado)'}</span>
                    </div>
                `;
                button.addEventListener('click', () => loadText(index));
                textSelectorContainer.appendChild(button);
            });
        }

        function loadText(index) {
            currentTextIndex = index;
            const textData = readingContent[currentTextIndex];

            if (!textData) {
                console.error("No se encontr√≥ el texto para el √≠ndice:", index);
                return;
            }

            // Mostrar la secci√≥n de contenido
            lessonContentDiv.classList.remove('hidden');
            // Ocultar el selector de textos temporalmente si se desea
            // textSelectorContainer.parentElement.classList.add('hidden');

            storyTitleElem.textContent = textData.title;
            // storyImageElem.src = textData.imageUrl; // L√≠nea de imagen eliminada
            storyTextElem.innerHTML = textData.text; // Usar innerHTML para el contenido HTML de los textos

            renderQuestions(textData.questions);
            resetQuizState(); // Limpiar respuestas y feedback
            updateNavigationButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' }); // Volver al inicio de la p√°gina
        }

        function renderQuestions(questions) {
            questionsContainer.innerHTML = ''; // Limpiar preguntas anteriores
            questions.forEach((q, qIndex) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block p-4 bg-yellow-50 rounded-lg shadow-sm border border-yellow-200';
                questionBlock.innerHTML = `
                    <p class="text-xl font-semibold text-gray-800 mb-3">${q.question}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${q.options.map((option, optIndex) => `
                            <label class="option-label flex items-center bg-yellow-200 p-3 rounded-lg hover:bg-yellow-300 transition duration-200 ease-in-out cursor-pointer">
                                <input type="radio" name="q${q.id}" value="${option}" class="form-radio h-5 w-5 text-yellow-600">
                                <span class="ml-2 text-gray-800 font-medium">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                    <p class="feedback-message mt-3 font-medium"></p>
                `;
                questionsContainer.appendChild(questionBlock);
            });
        }

        function resetQuizState() {
            const questionBlocks = questionsContainer.querySelectorAll('.question-block');
            questionBlocks.forEach(block => {
                const options = block.querySelectorAll('input[type="radio"]');
                const feedbackMessage = block.querySelector('.feedback-message');

                options.forEach(option => {
                    option.checked = false; // Desmarcar todas las opciones
                    option.disabled = false; // Habilitar opciones
                });
                feedbackMessage.textContent = ''; // Limpiar mensajes de retroalimentaci√≥n
                feedbackMessage.className = 'feedback-message mt-3 font-medium'; // Resetear clases
            });

            checkBtn.disabled = false;
            checkBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            nextTextBtn.classList.add('hidden'); // Ocultar bot√≥n de siguiente texto
        }

        function updateNavigationButtons() {
            // No hay botones de navegaci√≥n de texto previo/siguiente aqu√≠, solo el de "Siguiente Aventura"
            // que se muestra al completar el quiz.
            // Siempre se puede volver al selector de textos.
        }

        // --- L√ìGICA DE VERIFICACI√ìN ---
        function checkAnswers() {
            let allCorrect = true;
            const currentTextData = readingContent[currentTextIndex];
            const questionBlocks = questionsContainer.querySelectorAll('.question-block');

            questionBlocks.forEach((block, qIndex) => {
                const questionName = block.querySelector('input[type="radio"]').name;
                const selectedOption = block.querySelector(`input[name="${questionName}"]:checked`);
                const feedbackMessage = block.querySelector('.feedback-message');
                const options = block.querySelectorAll('input[type="radio"]');

                options.forEach(option => option.disabled = true); // Deshabilitar opciones

                if (selectedOption) {
                    // Encontrar la pregunta en los datos de readingContent para obtener la respuesta correcta
                    const questionData = currentTextData.questions[qIndex];
                    if (selectedOption.value === questionData.answer) {
                        feedbackMessage.textContent = '¬°Correcto! ‚úÖ';
                        feedbackMessage.className = 'feedback-message mt-3 font-medium text-green-600';
                    } else {
                        feedbackMessage.textContent = `Incorrecto. La respuesta correcta era: "${questionData.answer}" ‚ùå`;
                        feedbackMessage.className = 'feedback-message mt-3 font-medium text-red-600';
                        allCorrect = false;
                    }
                } else {
                    feedbackMessage.textContent = 'Por favor, selecciona una opci√≥n. ‚ö†Ô∏è';
                    feedbackMessage.className = 'feedback-message mt-3 font-medium text-orange-600';
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                correctSound.play();
                // Marcar texto como completado y mostrar bot√≥n de siguiente
                markTextAsCompleted(currentTextData.id);
                if (currentTextIndex < readingContent.length - 1) {
                    nextTextBtn.classList.remove('hidden');
                }
            } else {
                incorrectSound.play();
            }

            checkBtn.disabled = true;
            checkBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // --- INICIALIZACI√ìN Y EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTextSelector(); // Renderiza los botones de selecci√≥n de texto al cargar

            // Cargar el √∫ltimo texto visitado si existe en localStorage
            const lastVisitedTextId = localStorage.getItem('lastVisitedTextId4thGrade'); // ID √∫nico para 4to grado
            if (lastVisitedTextId) {
                const index = readingContent.findIndex(t => t.id === lastVisitedTextId);
                if (index !== -1) {
                    loadText(index);
                } else {
                    loadText(0); // Si no se encuentra, carga el primero
                }
            } else {
                loadText(0); // Carga el primer texto por defecto
            }

            checkBtn.addEventListener('click', checkAnswers);
            resetBtn.addEventListener('click', resetQuizState);
            nextTextBtn.addEventListener('click', () => {
                if (currentTextIndex < readingContent.length - 1) {
                    loadText(currentTextIndex + 1);
                } else {
                    // Si ya es el √∫ltimo texto, quiz√°s volver al selector
                    lessonContentDiv.classList.add('hidden');
                    renderTextSelector();
                    alert("¬°Has completado todas las aventuras de lectura! ¬°Felicidades!");
                }
            });

            // Guardar el texto actual en localStorage cada vez que se carga uno
            window.addEventListener('beforeunload', () => {
                localStorage.setItem('lastVisitedTextId4thGrade', readingContent[currentTextIndex].id); // ID √∫nico
            });
        });
    </script>
</body>
</html>
